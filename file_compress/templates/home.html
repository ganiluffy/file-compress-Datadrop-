{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto mt-10 p-8 bg-gray-100 dark:bg-gray-800 rounded-2xl shadow-lg text-center">
  
  <h2 class="text-3xl font-bold mb-2">Welcome, {{ username }} ðŸ‘‹</h2>
  <p class="text-gray-600 dark:text-gray-400 mb-6">
    Upload your files below â€” weâ€™ll compress them securely and store them for you.
  </p>

  <!-- File Upload Form -->
  <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data" 
        class="border-2 border-dashed border-gray-400 dark:border-gray-600 p-10 rounded-2xl bg-white dark:bg-gray-900 hover:border-blue-500 transition-all duration-200"
        ondrop="dropHandler(event);" ondragover="dragOverHandler(event);" ondragleave="dragLeaveHandler(event);">
    
    <div id="dropText" class="text-gray-500 dark:text-gray-400">
      <i class="fa-solid fa-cloud-arrow-up text-5xl mb-4 text-blue-500"></i>
      <p class="text-lg mb-2">Drag & Drop your files here</p>
      <p class="text-sm">or</p>
      <input type="file" name="files[]" multiple id="fileInput" class="hidden" />
      <button type="button" onclick="document.getElementById('fileInput').click()" 
              class="mt-3 px-5 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-all duration-200">
        Choose Files
      </button>
      <p id="fileList" class="mt-3 text-sm text-gray-600 dark:text-gray-400"></p>
    </div>
  </form>

  <button form="uploadForm" type="submit" 
          class="mt-6 px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105">
    Upload & Compress
  </button>

  <div class="mt-6">
    <a href="/myfiles" class="text-blue-600 dark:text-blue-400 hover:underline">View My Files</a>
  </div>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-6">
        {% for category, message in messages %}
          <div class="p-3 rounded-lg text-center {% if category == 'success' %}bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100{% elif category == 'danger' %}bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100{% else %}bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
</div>

<script>
const dropArea = document.getElementById("uploadForm");
const dropText = document.getElementById("dropText");
const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");

function dragOverHandler(e) {
  e.preventDefault();
  dropArea.classList.add("border-blue-500");
  dropText.classList.add("text-blue-500");
}

function dragLeaveHandler(e) {
  e.preventDefault();
  dropArea.classList.remove("border-blue-500");
  dropText.classList.remove("text-blue-500");
}

function dropHandler(e) {
  e.preventDefault();
  dropArea.classList.remove("border-blue-500");
  dropText.classList.remove("text-blue-500");

  const files = e.dataTransfer.files;
  fileInput.files = files;
  displayFileNames(files);
}

fileInput.addEventListener("change", function() {
  displayFileNames(this.files);
});

function displayFileNames(files) {
  if (files.length > 0) {
    const names = Array.from(files).map(f => f.name).join(", ");
    fileList.textContent = `Selected: ${names}`;
  } else {
    fileList.textContent = "";
  }
}
</script>
{% endblock %}
